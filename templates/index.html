<!DOCTYPE html>
<html>
<head>
    <title>Manual Ballooning (Stable)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
</head>

<body>
<h3>PDF Ballooning Tool (Guaranteed)</h3>

<input type="file" id="pdfInput" accept=".pdf">

<br><br>

<canvas id="c" width="1200" height="800" style="border:1px solid #000"></canvas>

<script>
const canvas = new fabric.Canvas('c');
let balloonNo = 1;

document.getElementById('pdfInput').onchange = function () {
    const file = this.files[0];
    const formData = new FormData();
    formData.append("file", file);

    fetch("/upload_pdf", {
        method: "POST",
        body: formData
    })
    .then(res => res.json())
    .then(data => {
        fabric.Image.fromURL(data.image_url, img => {
            img.scaleToWidth(canvas.width);
            canvas.setBackgroundImage(img, canvas.renderAll.bind(canvas));
        });
    });
};

canvas.on('mouse:down', e => {
    if (e.target) return;

    const p = canvas.getPointer(e.e);

    const circle = new fabric.Circle({
        radius: 16,
        stroke: 'red',
        fill: 'white',
        strokeWidth: 2,
        originX: 'center',
        originY: 'center'
    });

    const text = new fabric.Text(balloonNo.toString(), {
        fontSize: 16,
        fill: 'red',
        originX: 'center',
        originY: 'center'
    });

    const group = new fabric.Group([circle, text], {
        left: p.x,
        top: p.y
    });

    canvas.add(group);
    balloonNo++;
});
</script>

</body>
</html>
